-- W8 Seed Data: 講師、課程、排課、家長學生關聯
-- 執行於: hivemind_db (Cloud SQL)
-- 日期: 2026-02-14

-- 愛學館 tenant/branch
-- tenant_id: 11111111-1111-1111-1111-111111111111
-- branch_id: a1b2c3d4-e5f6-1a2b-8c3d-4e5f6a7b8c9d

-- ========== 講師 (3位) ==========
INSERT INTO teachers (id, user_id, tenant_id, branch_id, name, title, phone, rate_per_class, status) VALUES
-- 王老師 (數學)
('a1000001-0001-0001-0001-000000000001', 
 (SELECT id FROM users WHERE username = 'teacher' LIMIT 1),
 '11111111-1111-1111-1111-111111111111',
 'a1b2c3d4-e5f6-1a2b-8c3d-4e5f6a7b8c9d',
 '王建民', '教師', '0912-345-678', 800.00, 'active'),

-- 李教練 (體育)
('a1000002-0002-0002-0002-000000000002',
 (SELECT id FROM users WHERE username = 'teacher2' LIMIT 1),
 '11111111-1111-1111-1111-111111111111',
 'a1b2c3d4-e5f6-1a2b-8c3d-4e5f6a7b8c9d',
 '李小龍', '教練', '0923-456-789', 1000.00, 'active'),

-- 陳講師 (英文)
('a1000003-0003-0003-0003-000000000003',
 NULL,
 '11111111-1111-1111-1111-111111111111',
 'a1b2c3d4-e5f6-1a2b-8c3d-4e5f6a7b8c9d',
 '陳美玲', '講師', '0934-567-890', 900.00, 'active')
ON CONFLICT DO NOTHING;

-- ========== 課程 (5門) ==========
INSERT INTO courses (id, tenant_id, branch_id, name, subject, duration_minutes, max_students, status) VALUES
('b1000001-0001-0001-0001-000000000001',
 '11111111-1111-1111-1111-111111111111',
 'a1b2c3d4-e5f6-1a2b-8c3d-4e5f6a7b8c9d',
 '國中數學進階班', '數學', 90, 8, 'active'),

('b1000002-0002-0002-0002-000000000002',
 '11111111-1111-1111-1111-111111111111',
 'a1b2c3d4-e5f6-1a2b-8c3d-4e5f6a7b8c9d',
 '國小數學基礎班', '數學', 60, 10, 'active'),

('b1000003-0003-0003-0003-000000000003',
 '11111111-1111-1111-1111-111111111111',
 'a1b2c3d4-e5f6-1a2b-8c3d-4e5f6a7b8c9d',
 '英文會話班', '英文', 60, 6, 'active'),

('b1000004-0004-0004-0004-000000000004',
 '11111111-1111-1111-1111-111111111111',
 'a1b2c3d4-e5f6-1a2b-8c3d-4e5f6a7b8c9d',
 '體適能訓練班', '體育', 90, 12, 'active'),

('b1000005-0005-0005-0005-000000000005',
 '11111111-1111-1111-1111-111111111111',
 'a1b2c3d4-e5f6-1a2b-8c3d-4e5f6a7b8c9d',
 '國中英文寫作班', '英文', 90, 8, 'active')
ON CONFLICT DO NOTHING;

-- ========== 排課 (20筆，本週+下週) ==========
INSERT INTO schedules (id, course_id, teacher_id, scheduled_date, start_time, end_time, status, notes) VALUES
-- 週一
('d1000001-0001-0001-0001-000000000001', 'b1000001-0001-0001-0001-000000000001', 'a1000001-0001-0001-0001-000000000001', '2026-02-16', '16:00', '17:30', 'scheduled', '國中數學 週一班'),
('d1000002-0002-0002-0002-000000000002', 'b1000003-0003-0003-0003-000000000003', 'a1000003-0003-0003-0003-000000000003', '2026-02-16', '18:00', '19:00', 'scheduled', '英文會話 週一班'),

-- 週二
('d1000003-0003-0003-0003-000000000003', 'b1000002-0002-0002-0002-000000000002', 'a1000001-0001-0001-0001-000000000001', '2026-02-17', '15:00', '16:00', 'scheduled', '國小數學 週二班'),
('d1000004-0004-0004-0004-000000000004', 'b1000004-0004-0004-0004-000000000004', 'a1000002-0002-0002-0002-000000000002', '2026-02-17', '17:00', '18:30', 'scheduled', '體適能 週二班'),

-- 週三
('d1000005-0005-0005-0005-000000000005', 'b1000001-0001-0001-0001-000000000001', 'a1000001-0001-0001-0001-000000000001', '2026-02-18', '16:00', '17:30', 'scheduled', '國中數學 週三班'),
('d1000006-0006-0006-0006-000000000006', 'b1000005-0005-0005-0005-000000000005', 'a1000003-0003-0003-0003-000000000003', '2026-02-18', '18:00', '19:30', 'scheduled', '英文寫作 週三班'),

-- 週四
('d1000007-0007-0007-0007-000000000007', 'b1000002-0002-0002-0002-000000000002', 'a1000001-0001-0001-0001-000000000001', '2026-02-19', '15:00', '16:00', 'scheduled', '國小數學 週四班'),
('d1000008-0008-0008-0008-000000000008', 'b1000004-0004-0004-0004-000000000004', 'a1000002-0002-0002-0002-000000000002', '2026-02-19', '17:00', '18:30', 'scheduled', '體適能 週四班'),
('d1000009-0009-0009-0009-000000000009', 'b1000003-0003-0003-0003-000000000003', 'a1000003-0003-0003-0003-000000000003', '2026-02-19', '19:00', '20:00', 'scheduled', '英文會話 週四班'),

-- 週五
('d1000010-0010-0010-0010-000000000010', 'b1000001-0001-0001-0001-000000000001', 'a1000001-0001-0001-0001-000000000001', '2026-02-20', '16:00', '17:30', 'scheduled', '國中數學 週五班'),

-- 週六
('d1000011-0011-0011-0011-000000000011', 'b1000002-0002-0002-0002-000000000002', 'a1000001-0001-0001-0001-000000000001', '2026-02-21', '09:00', '10:00', 'scheduled', '國小數學 週六上午班'),
('d1000012-0012-0012-0012-000000000012', 'b1000004-0004-0004-0004-000000000004', 'a1000002-0002-0002-0002-000000000002', '2026-02-21', '10:30', '12:00', 'scheduled', '體適能 週六班'),
('d1000013-0013-0013-0013-000000000013', 'b1000003-0003-0003-0003-000000000003', 'a1000003-0003-0003-0003-000000000003', '2026-02-21', '14:00', '15:00', 'scheduled', '英文會話 週六班'),
('d1000014-0014-0014-0014-000000000014', 'b1000005-0005-0005-0005-000000000005', 'a1000003-0003-0003-0003-000000000003', '2026-02-21', '15:30', '17:00', 'scheduled', '英文寫作 週六班'),

-- 下週一
('d1000015-0015-0015-0015-000000000015', 'b1000001-0001-0001-0001-000000000001', 'a1000001-0001-0001-0001-000000000001', '2026-02-23', '16:00', '17:30', 'scheduled', NULL),
('d1000016-0016-0016-0016-000000000016', 'b1000003-0003-0003-0003-000000000003', 'a1000003-0003-0003-0003-000000000003', '2026-02-23', '18:00', '19:00', 'scheduled', NULL),

-- 下週二
('d1000017-0017-0017-0017-000000000017', 'b1000002-0002-0002-0002-000000000002', 'a1000001-0001-0001-0001-000000000001', '2026-02-24', '15:00', '16:00', 'scheduled', NULL),
('d1000018-0018-0018-0018-000000000018', 'b1000004-0004-0004-0004-000000000004', 'a1000002-0002-0002-0002-000000000002', '2026-02-24', '17:00', '18:30', 'scheduled', NULL),

-- 下週三
('d1000019-0019-0019-0019-000000000019', 'b1000001-0001-0001-0001-000000000001', 'a1000001-0001-0001-0001-000000000001', '2026-02-25', '16:00', '17:30', 'scheduled', NULL),
('d1000020-0020-0020-0020-000000000020', 'b1000005-0005-0005-0005-000000000005', 'a1000003-0003-0003-0003-000000000003', '2026-02-25', '18:00', '19:30', 'scheduled', NULL)
ON CONFLICT DO NOTHING;

-- ========== 課程學生關聯 ==========
-- 將現有學生分配到各課程
INSERT INTO course_enrollments (course_id, student_id, status)
SELECT 'b1000001-0001-0001-0001-000000000001', id, 'active' 
FROM students WHERE grade_level IN ('國中一年級', '國中二年級') LIMIT 4
ON CONFLICT DO NOTHING;

INSERT INTO course_enrollments (course_id, student_id, status)
SELECT 'b1000002-0002-0002-0002-000000000002', id, 'active' 
FROM students WHERE grade_level IN ('國小五年級', '國小六年級') LIMIT 4
ON CONFLICT DO NOTHING;

INSERT INTO course_enrollments (course_id, student_id, status)
SELECT 'b1000003-0003-0003-0003-000000000003', id, 'active' 
FROM students LIMIT 5
ON CONFLICT DO NOTHING;

INSERT INTO course_enrollments (course_id, student_id, status)
SELECT 'b1000004-0004-0004-0004-000000000004', id, 'active' 
FROM students LIMIT 6
ON CONFLICT DO NOTHING;

INSERT INTO course_enrollments (course_id, student_id, status)
SELECT 'b1000005-0005-0005-0005-000000000005', id, 'active' 
FROM students WHERE grade_level LIKE '國中%' LIMIT 4
ON CONFLICT DO NOTHING;

-- ========== 家長-學生關聯 ==========
-- 將 parent 角色的 users 關聯到學生
INSERT INTO parent_students (parent_id, student_id, relationship, is_primary)
SELECT 
  u.id,
  s.id,
  '家長',
  true
FROM users u
CROSS JOIN LATERAL (
  SELECT id FROM students ORDER BY RANDOM() LIMIT 2
) s
WHERE u.role = 'parent'
ON CONFLICT DO NOTHING;
